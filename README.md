# GIT学習メモ

## ローカル/リモートリポジトリへのコミットの流れ

```ditaa {cmd=true args=["-E"]}
  +-------------------------------------------------------------------+
  |  +-work tree--+   +--------loacal repository--------------------+ |
  |  |            |   |  +---git directory-----------------------+  | |
  |  |            |   |  |  +-staging area--+                    |  | |
  |  |            |   |  |  |               |                    |  | |
  |  | +------+   |   |  |  |  +----------+ |         +--------+ |  | |
  |  | |edited|-register-+--+->|registered|-+-commit->|commited| |  | |
  |  | |File  |   |   |  |  |  | File     | |         |File    | |  | |
  |  | +------+   |   |  |  |  +----------+ |         +--------+ |  | |
  |  |   ^        |   |  |  |               |                    |  | |
  |  |   |        |   |  |  +---------------+                    |  | |
  |  |  edit      |   |  |                                       |  | |
  |  |   |        |   |  +---------------------------------------+  | |
  |  | +----+     |   |                                             | |
  |  | |File|     |   |                                             | |
  |  | +----+     |   +---------------------------------------------+ |
  |  |            |                                                   |
  |  +------------+                                                   |
  +--A folder managed by Git------------------------------------------+
```

ワークツリーでファイルの編集等を行い
一旦、ステージングエリアに登録してからローカルリポジトリに登録する。
これは全てgitで管理されたフォルダー内で行う。

でローカルの変更をリモートリポジトリに反映したり、
リモートの変更をローカルに反映させたりする。

## ワード

* コミット：ステージングエリアやgit ディレクトリへ編集記録を保存すること
* プル：リモートリポジトリの内容をローカルリポジトリに取得し、ワークツリーに反映させること。
* フォーク：モートリポジトリの内容をローカルリポジトリに取得のみ。ワークツリーへの反映はしない。複製元のリポジトリに影響なくファイル変更ができる。複製元へのマージもできる
* クローン：github上のリポジトリをローカルに丸ごと取得すること
* ブランチ：履歴を枝分かれさせること。主に作業ごとに作成し履歴をみやすくする。
* マージ：ブランチの統合
* プッシュ：リモートに変更を反映すること。

## GITコマンド

### 基本操作

* カレントディレクトリのパス確認
  * pwd
* git versionの確認
  * git --version
* git設定値の一覧を確認
  * git config --list
* git にvs codeを設定する
  * git config --global core.editor "`vs code exe path` --wait"
* 指定dirを作業フォルダにしてvscodeを開く
  * code `dir path`
* カレントを作業フォルダにしてvs codeを開く
  * code .

### ローカルリポジトリ操作

* ローカルリポジトリを作る
  * git init
* ファイルの状態を確認
  * git status
* 指定ファイルをステイジングエリアに登録する
  * git add `file_name`
* カレント配下の全てのファイルをステイジングエリアに登録する
  * git add .
* 指定ディレクトリをステイジングエリアに登録する
  * git add `directory_name`
* 指定ディレクトリ内のファイルをステイジングエリアに登録する
  * git add `dir_name/file_name`
* ワークツリーとステージングエリアの差分を確認
  * git diff
* ローカルリポジトリにコミットする
  * git commit
* コメント付きでローカルリポジトリにコミットする
  * git commit -m "comments"
* ワークツリーからステイジングエリアを介して一気にリポジトリにコミットする
  * git commit -am "comments"
* gir ディレクトリとステージングエリアの差分を確認
  * git diff --cached
* ステイジングエリアへの登録取り消し
  * git reset
* git ディレクトリの情報を使いワークツリーの変更を取り消す
  * git checkout -- "file path or dir path"
* ファイル消去
  * git rm `file_name`
* ディレクトリの消去
  * git rm -r `dir_name`
* コミット履歴の確認
  * git log
* 差分付きでコミット履歴の確認
  * git log -p
* ローカルブランチ作成
  * git branch `branch name`
* gitディレクトリ内の作成済みブランチ一覧と使用中ブランチ確認
  * git branch
    アスタリスクが付いているブランチが使用中ブランチ
* ブランチへの切り替え
  * git switch `branch name`
* ブランチ作成して切り替え
  * git switch -c `branch name`

### リモートリポジトリに関連した操作

* githubのリモートリポジトリをクローンする。
  * git clone `Github ssh url`
* ブランチをプッシュする
  * git push origin `branch name`
* リモートリポジトリの内容をローカルリポジトリに反映
  * git pull `リモートリポジトリ名(gitが初期に付けるやつだとorigin)` `ブランチ名(master とか　自分で作ったやつ)`
* ローカルリポジトリに存在しないリモートブランチの取得
  1. git fetch origin
  2. git switch `branch name`


## Git Tips

### Gitで管理しないファイル一覧の設定

`.gitignore`をgit　ディレクトリに作成し、そのファイル内に管理外ファイルを記入
リポジトリに`.gitignore`を登録する。
記入例：

```
subDir/file1.txt  # ファイル名指定
target/           # ディレクトリ指定
*.log             # 拡張子指定
```

## GitHub Tips

### プルリクエストの作成

変更内容を変更を加えた人以外にチェックしてもらうために行う。

#### 手順

1. githubのリポジトリにて`pull requests`をクリック
2. `new pull requests`をクリック
3. ベースブランチ（マージ先）とトピックブランチ（レビュー対象）を選択
4. タイトル、コメント（変更内容、その背景）を記入
5. `Reiviewers`をクリック
6. レビュアーを選択
7. `Create pull requests`をクリック

### プルリクエストの承認

pull requestsを押して変更を確認し

* 承認可能な場合
  * `Appraove changes`をクリック
* 修正が必要な場合
  * `Re-resuqests review`をクリック
* レビューを取り下げたい場合
  * `Dismiss review`をクリック

### ブランチをmasterブランチにマージする前に

変更があるかもしれないのでmasterから最新状態を取り組む

`git merge master`
をする。

コンフリクトした場合：
`git status`でコンフリクトファイルを確認
vs codeでコンフリクトファイルを開くとコンフリクト箇所が以下のように出る：

```html
<<<< HEAD
<td>test</td>
======
<td>foo</td>
<td>Hoge</td>
>>>> master
```

の箇所にて

HEADから===までが使用中変更点
===からmasterまでがマージ元の変更点

変更内容に考慮しつつ修正する

修正後、

1. git add -A:ステイジングエリアに登録
2. git commit:ローカルにコミット
3. git `push origin` `branch`:プッシュ

### ブランチをmasterブランチにマージ

pull requestsを押して変更を確認し

`Merge pull request`の横の▽を押しマージ方法を選択して完了。
慣れないうちは`Create a merge commit`を選択

#### Create a merge commit

ブランチを作成

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+
-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+
    |
    |     *--*   *--*
    +---->|  |-->|  |
          *--*   *--*
```

ブランチをマージ

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+   *--+
-->|  |-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+   +--*
    |                    ^
    |     *--*   *--*    |
    +---->|  |-->|  |----+
          *--*   *--*
```

マージコミットというマージを記録するコミットが作成され、
全記録が残る

#### Squash and merge

ブランチを作成

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+
-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+
    |
    |     *--*   *--*
    +---->|  |-->|  |
          *--*   *--*
```

ブランチをマージ

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+   *--+
-->|  |-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+   +--*
```

マージコミットというマージを記録するコミットが作成され、
ブランチは消える。見通しが良い。

#### Rebase and merge

ブランチを作成

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+
-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+
    |
    |     *--*   *--*
    +---->|  |-->|  |
          *--*   *--*
```

ブランチをマージ

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+   
-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+   
                  |                   
                  |     *--*   *--*   
                  +---->|  |-->|  |-->
                        *--*   *--*   
```

最後直線のコミット履歴になる

```ditaa {cmd=true args=["-E"]}
   +--+   +--+   +--+   *--*   *--*   
-->|  |-->|  |-->|  |-->|  |-->|  |-->
   +--+   +--+   +--+   *--*   *--*   
```

### Githubの使い方

Githubの検索ボックスで関連リポジトリを見つける

検索例：
`stars:>=1000`1000個以上星が付いたリポジトリ検索
`stars:>=1000 language:jave`1000個以上星が付いたjava言語リポジトリ検索
